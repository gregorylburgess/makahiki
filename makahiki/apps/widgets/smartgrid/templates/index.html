{% load class_tags %}

<div {% get_id_and_classes "activity-categories-box" %}>
    <div {% get_id_and_classes "activity-categories-title" %}>
        The Smart Grid Game
        <a href="#" style="float: right">
            <img src="{{ STATIC_URL}}/css/default/images/icon-help-sm.png" width="20" align="center"
                 title="Click to get help about this window"
                 onclick="toggleHelp('widget', 'smart-grid-game'); return false;"
                    /></a>
    </div>
    <div {% get_id_and_classes "activity-categories-content" %}>
        <p>
        <table {% get_id_and_classes "activities-grid" %}>
            <tr><!-- Start header -->
                {% for cat in view_objects.smartgrid.categories %}
                    <td>
                        <div {% get_id_and_classes "activity-category" %}>
                            <div class="get-started">
                                <div class="">
                                    <p></p>
                                    <h5> {{ cat.name }}</h5>
                                </div>
                            </div>
                        </div>
                    </td>
                {% endfor %}
            </tr>
            <!-- End header -->
            <tr>
                {% for cat in view_objects.smartgrid.categories %}
                    <td>
                        <table>
                            {% for task in cat.task_list %}
                                <tr>
                                    <td width="14">
                                        <div {% get_id_and_classes "activity-category" %}>
                                            <div class="{{task.type}}">
                                                <div class="">
                                                    {% if task.is_unlock %}
                                                        <a href="{% url activity_task task.type task.slug %}"
                                                           title="{{task.name}}">
                                                            {% if task.type != 'commitment' %}
                                                                {% if task.is_pau %}
                                                                    {% if task.approval.approval_status == "rejected" %}
                                                                        <img src="{{ STATIC_URL}}/css/default/images/icon-exclamation2.png"
                                                                             width="12"
                                                                             align="left"/>
                                                                    {% else %}
                                                                        {% if task.approval.approval_status == "pending" and task.is_event_pau %}
                                                                            <img src="{{ STATIC_URL}}/css/default/images/icon-exclamation2.png"
                                                                                 width="12"
                                                                                 align="left"/>
                                                                        {% else %}
                                                                            <img src="{{ STATIC_URL}}/css/default/images/icon-done.png"
                                                                                 width="12"
                                                                                 align="left"/>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                    <br/>
                                                                    {{ task.name }}
                                                                {% else %}
                                                                    <br/>
                                                                    {% if task.point_value %}
                                                                        <h3>{{ task.point_value }}</h3>
                                                                    {% else %}
                                                                        <h3>{{ task.point_range_end }}</h3>
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% else %}
                                                                {# ------ is commitment #}
                                                                {% if task.is_pau %}
                                                                    {% if task.approval.days_left != 0 or task.approval.award_date %}
                                                                        <img src="{{ STATIC_URL}}/css/default/images/icon-done.png"
                                                                             width="12"
                                                                             align="left">
                                                                    {% else %}
                                                                        <img src="{{ STATIC_URL}}/css/default/images/icon-exclamation2.png"
                                                                             width="12"
                                                                             align="left"/>
                                                                    {% endif %}
                                                                    <br/>
                                                                    {{ task.name }}
                                                                {% else %}
                                                                    <br/>
                                                                    <h3>{{ task.point_value }}</h3>
                                                                {% endif %} {# end task.is_pau #}
                                                            {% endif %}
                                                            {# ------- end task.type #}
                                                        </a>
                                                    {% else %}        {# ------ is lock #}
                                                        <br/>
                                                        <a class="whatever"
                                                           href="javascript:void(0);">
                                                            <img src="{{ STATIC_URL}}/css/default/images/lock24.png"
                                                                 width="22" align="top"
                                                                 title="Click to see how to unlock"
                                                                 onclick="unlock_dialog('{{task.type}}','{{task.slug}}',
                                                                         {% if task.depends_on_text %}
                                                                             '{{task.depends_on_text}}'
                                                                         {% else %}
                                                                             '{{task.depends_on}}'
                                                                         {% endif %}
                                                                         )">
                                                        </a>

                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}

                        </table>
                    </td>
                {% endfor %}
            </tr>
        </table>

        <p/>

        <table {% get_id_and_classes "activities-grid-legend" %}>
            <tr>
                <td colspan="10"><b>Legend:</b></td>
            </tr>
            <tr>
                <td>
                    <div class="activity-legend"></div>
                </td>
                <td width=100>activity</td>
                <td>
                    <div class="commitment-legend"></div>
                </td>
                <td width=100>commitment</td>
                <td>
                    <div class="event-legend"></div>
                </td>
                <td width=100>event</td>
                <td>
                    <div class="excursion-legend"></div>
                </td>
                <td width=100>excursion</td>
                <td>
                    <div class="survey-legend"></div>
                </td>
                <td width=100>special</td>
            </tr>
        </table>

    </div>
</div>

<div id="unlock-dialog" title="Locked Activity" style="visibility: hidden;">
    <div style="text-align:left">
        <p><b>This activity is locked.</b></p>

        <p> To unlock this activity, please do the following: <br/>

        <div id="depends_on">
        </div>
        </p>
        <center>
            <input type="submit" value="OK" onclick='$("#unlock-dialog").dialog("close");'/>
        </center>
    </div>
</div>

<script type="text/javascript">
    function unlock_dialog(type, slug, depends_on) {
        el = document.getElementById("unlock-dialog");
        el.style.visibility = "visible";
        $("#unlock-dialog").dialog({
            modal:true,
            width:450,
            closeOnEscape:false,
            position:[400, 100],
            open:function (event, ui) {
                log_js_action(type, slug, 'view-lock-open');
            },
            close:function (event, ui) {
                log_js_action(type, slug, 'view-lock-close');
            }
        });

        document.getElementById("depends_on").innerHTML = depends_on;
    }
</script>
